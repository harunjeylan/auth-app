{"version":3,"sources":["../../../src/auth/jwt-auth/jwt-auth.guard.ts"],"sourcesContent":["import {\n  CanActivate,\n  ExecutionContext,\n  Injectable,\n  Logger,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport { JwtAuthService } from './jwt-auth.service';\nimport { getAuthTokenFromContext } from '../helpers/getAuthTokenFromContext';\nimport { getRequestFromContext } from '../helpers/getRequestFromContext';\nimport { AuthService } from '../auth.service';\n\n@Injectable()\nexport class JwtAuthGuard implements CanActivate {\n  private readonly logger = new Logger(JwtAuthGuard.name);\n  constructor(\n    private readonly jwtAuthService: JwtAuthService,\n    private readonly authService: AuthService,\n  ) {}\n\n  async canActivate(context: ExecutionContext) {\n    this.logger.log(this.canActivate.name);\n\n    const authHeader = getAuthTokenFromContext(context);\n    const request = getRequestFromContext<{ user: any }>(context);\n    const token = authHeader && authHeader.split(' ')[1];\n\n    if (!token) {\n      throw new UnauthorizedException('Unauthorized');\n    }\n\n    const data = await this.jwtAuthService.decryptJwtAccessToken<{\n      userId: string;\n    }>(token);\n\n    if (!data) {\n      throw new UnauthorizedException('Access Token Invalid or Expired!');\n    }\n\n    const user = await this.authService.findOne(data.userId);\n    if (!user) {\n      throw new UnauthorizedException('User Not Found With Access Token!');\n    }\n    request.user = user;\n    return true;\n  }\n}\n"],"names":["JwtAuthGuard","canActivate","context","logger","log","name","authHeader","getAuthTokenFromContext","request","getRequestFromContext","token","split","UnauthorizedException","data","jwtAuthService","decryptJwtAccessToken","user","authService","findOne","userId","constructor","Logger","Injectable"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAaaA;;;eAAAA;;;wBAPN;gCACwB;yCACS;uCACF;6BACV;;;;;;;;;;AAGrB,IAAA,AAAMA,eAAN,MAAMA;IAOX,MAAMC,YAAYC,OAAyB,EAAE;QAC3C,IAAI,CAACC,MAAM,CAACC,GAAG,CAAC,IAAI,CAACH,WAAW,CAACI,IAAI;QAErC,MAAMC,aAAaC,IAAAA,gDAAuB,EAACL;QAC3C,MAAMM,UAAUC,IAAAA,4CAAqB,EAAgBP;QACrD,MAAMQ,QAAQJ,cAAcA,WAAWK,KAAK,CAAC,IAAI,CAAC,EAAE;QAEpD,IAAI,CAACD,OAAO;YACV,MAAM,IAAIE,6BAAqB,CAAC;QAClC;QAEA,MAAMC,OAAO,MAAM,IAAI,CAACC,cAAc,CAACC,qBAAqB,CAEzDL;QAEH,IAAI,CAACG,MAAM;YACT,MAAM,IAAID,6BAAqB,CAAC;QAClC;QAEA,MAAMI,OAAO,MAAM,IAAI,CAACC,WAAW,CAACC,OAAO,CAACL,KAAKM,MAAM;QACvD,IAAI,CAACH,MAAM;YACT,MAAM,IAAIJ,6BAAqB,CAAC;QAClC;QACAJ,QAAQQ,IAAI,GAAGA;QACf,OAAO;IACT;IA9BAI,YACE,AAAiBN,cAA8B,EAC/C,AAAiBG,WAAwB,CACzC;aAFiBH,iBAAAA;aACAG,cAAAA;aAHFd,SAAS,IAAIkB,cAAM,CAACrB,aAAaK,IAAI;IAInD;AA4BL;AAjCaL;IADZsB,IAAAA,kBAAU;;;eAI0B,8BAAc,4BAAd,8BAAc;eACjB,wBAAW,4BAAX,wBAAW;;GAJhCtB"}